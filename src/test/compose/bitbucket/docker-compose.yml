# docker-compose --project-name bitbucket

web:
  domainname: example.com
  hostname: bitbucket
  image: nginx:1.9
  links:
    - app:app
  ports:
    - 80:80
    - 443:443
  volumes:
    - bitbucket-nginx-cache:/var/cache/nginx
    - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
# run ../../scripts/mk-self-signed-cert.sh to create a self-signed cert for bitbucket.example.com
    - ./server.key:/etc/ssl/private/server.key:ro
    - ./server.crt:/etc/ssl/private/server.crt:ro

app:
  environment:
    BITBUCKET_CONNECTOR_PROXY_NAME: bitbucket.example.com
  domainname: example.com
  hostname: bitbucket
  image: dweomer/atlassian-bitbucket
  links:
    - db:db
  ports:
    - 7999:7999
  volumes:
    - bitbucket-home:/var/lib/bitbucket
    - ./bitbucket.properties:/var/lib/bitbucket/shared/bitbucket.properties:ro

db:
  image: postgres:9
  environment:
    POSTGRES_USER: bitbucket
    POSTGRES_PASSWORD: bitbucket
  volumes:
    - bitbucket-data:/var/lib/postgresql/data
